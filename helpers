#!/bin/bash
mkdir -p ~/.local/bin

cat > ~/.local/bin/opac << 'EOF'
#!/bin/bash

val="$1"

# Справка
[ -z "$val" ] && {
    echo "opac <значение>"
    echo "Проценты:"
    echo "  opac 1     = 1% прозрачности (0.01)"
    echo "  opac 20    = 20% прозрачности (0.20)"
    echo "  opac 50    = 50% прозрачности (0.50)"
    echo "  opac 100   = непрозрачный (1.0)"
    echo "Десятичные:"
    echo "  opac 0.3   = 30% прозрачности"
    echo "  opac 0.85  = 85% прозрачности"
    exit 1
}

# Конвертация целых чисел (процентов)
if [[ "$val" =~ ^[0-9]+$ ]]; then
    if (( val == 0 )); then
        val="0.0"
    elif (( val == 100 )); then
        val="1.0"
    elif (( val < 10 )); then
        # 1-9 -> 0.01-0.09
        val="0.0$val"
    elif (( val < 100 )); then
        # 10-99 -> 0.10-0.99
        val="0.$val"
    else
        echo "Ошибка: должно быть 0-100"
        exit 1
    fi
fi

# Проверка десятичного формата
if [[ ! "$val" =~ ^0\.[0-9][0-9]?$|^1\.0$|^0\.0$ ]]; then
    echo "Ошибка: используйте 0.01-1.0 или 1-100"
    exit 1
fi

# Применяем настройки
for profile in $(dconf list /org/gnome/Ptyxis/Profiles/ 2>/dev/null); do
    clean_profile=$(echo "${profile%/}" | tr -d "'\"")
    dconf write "/org/gnome/Ptyxis/Profiles/$clean_profile/opacity" "double $val" 2>/dev/null
done

# Показываем что установили
percent=""
case "$val" in
    "0.0") percent="0" ;;
    "1.0") percent="100" ;;
    *)
        # 0.01 -> 1%, 0.20 -> 20%, 0.99 -> 99%
        without_zero="${val#0.}"
        percent=$(echo "$without_zero" | sed 's/^0*//')
        ;;
esac

echo "✓ Прозрачность: ${percent}% ($val)"
EOF

chmod +x ~/.local/bin/opac
echo "Готово! Теперь:"
echo "  opac 1   = 1% прозрачности"
echo "  opac 20  = 20% прозрачности"
echo "  opac 100 = непрозрачный"
